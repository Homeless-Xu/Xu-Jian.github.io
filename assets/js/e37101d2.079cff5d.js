"use strict";(self.webpackChunkblog_never_del=self.webpackChunkblog_never_del||[]).push([[661],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),s=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=s(e.components);return r.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(t),m=o,k=c["".concat(p,".").concat(m)]||c[m]||d[m]||a;return t?r.createElement(k,i(i({ref:n},u),{},{components:t})):r.createElement(k,i({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},3233:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var r=t(7462),o=(t(7294),t(3905));const a={sidebar_position:150,title:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI \u279c Custom IMG"},i="Custom IMG Driver",l={unversionedId:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI",id:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI",title:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI \u279c Custom IMG",description:"\ud83d\udd35 why",source:"@site/docs/\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI.md",sourceDirName:".",slug:"/\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI",permalink:"/\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI",draft:!1,tags:[],version:"current",sidebarPosition:150,frontMatter:{sidebar_position:150,title:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa ESXI \u279c Custom IMG"},sidebar:"defaultSidebar",previous:{title:"\ud83c\udfaa-3\ufe0f\u20e3 Blog \ud83d\udcda\u279c Docusaurus",permalink:"/\ud83c\udfaa-3\ufe0f\u20e3 Blog \ud83d\udcda\u279c Docusaurus"},next:{title:"\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa\ud83d\udcfa Ubuntu init",permalink:"/\ud83c\udfaa-5\ufe0f\u20e3 SYS \ud83d\udcfa\ud83d\udcfa Ubuntu init"}},p={},s=[],u={toc:s};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"custom-img-driver"},"Custom IMG Driver"),(0,o.kt)("p",null,"\ud83d\udd35 why"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"- new laptop no nic port \n- onl pc nic no support esxi\n\nif no nic or nic not support esxi.\nso you need use usb-nic\nneed a custom esxi image \n\n-.- custom esxi img is not easy. \n\ni have make & upload a esxi 7.0.2 imag with all usb-nic already.\nhttps://www.dropbox.com/sh/7am6rvm2wk1dt2x/AABQhaQdXmdtiOM_Kv2PerN2a?dl=0\n")),(0,o.kt)("p",null,"\ud83d\udd35 How"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"only two way to put driver to esxi image.\n1. use vcenter >> auto deploy     \u279c  with GUI\n2. use command under windows      \u279c  only CLI.\n    both way are very similar. both use vmware tool.\n    vcenter have buildin tool.\n    windows. need install a vmware tool.\n")),(0,o.kt)("p",null,"\ud83d\udd35 usb nic dirver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83d\udd25  esxi 7.0.3 with  usb-nic-driver 7.0.3 not Compatible... \u203c\ufe0f\n\ud83d\udd25  esxi 7.0.3 with  usb-nic-driver 7.0.3 not Compatible... \u203c\ufe0f\n\ud83d\udd25  esxi 7.0.3 with  usb-nic-driver 7.0.3 not Compatible... \u203c\ufe0f\n")),(0,o.kt)("p",null,"\ud83d\udd35 Files "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"you need two file:  esxi.zip + driver.zip   to build a new image.\n\nboth windos cli and vcenter gui will give you esxi.zip \nso download driver you need. from esxi offical website manual.\n")),(0,o.kt)("p",null,"\ud83d\udd35 get usb-nic-driver.zip"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"https://flings.vmware.com/usb-network-native-driver-for-esxi\n")),(0,o.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 vCenter "),(0,o.kt)("p",null,"\ud83d\udd36 enable function"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"web >> auto deploy >> enable image builder \n")),(0,o.kt)("p",null,"\ud83d\udd36 upload driver  use custom depot"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"new >> custom depot :  usb \n>> under usb custom.    \n    >> click software package >> import >> upload \n")),(0,o.kt)("p",null,"\ud83d\udd36 Go online depot "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"auto deploy >> new >> online build. >>\n\nhttps://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\n\n\n\u25ce choose a esxi  standard version\n    choose esxi7xxxxxxs-stand \n\n\u25ce then clone ! \n    during clone \n\n    \u25ce in select software packages.\n    choose the driver you upload!!!! \n    leave other by default.\n\n    >> next >> finist \n")),(0,o.kt)("p",null,"\ud83d\udd36 download custom iso"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"under one depot.\nthere is a clone xxxxx.\n\nexport with iso. \ndonw \n")),(0,o.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 Windows cli "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u203c\ufe0f Good video tour \u203c\ufe0f\nhttps://www.youtube.com/watch?v=RvD6N-sROtI\n\nhttps://vmexplorer.com/2019/09/13/create-an-esxi-installation-iso-with-custom-drivers-in-9-easy-steps/\n")),(0,o.kt)("p",null,"\ud83d\udd35 VMware.PowerCLI Desc \u2705"),(0,o.kt)("p",null,"  a tool make you can use vmware cmd on windows.\nbecause you need download esxi file during building.\nthis need use vmware cmd."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\ud83d\udd36 windows Install   VMware.PowerCLI\n\n    PS C:\\Users\\Administrator> Install-Module VMware.PowerCLI -Scope CurrentUser\n")),(0,o.kt)("p",null,"\ud83d\udd35 Download esxi.zip"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\ud83d\udd36 Download \n\n    https://mirrors.dtops.cc/ISO/ESXI/\n    choose xxx.zip  not xxx.iso\n\n\ud83d\udd36 Download  use cli \n\n    Add-EsxSoftwareDepot https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\n\n    Export-ESXImageProfile -ImageProfile "ESXi-7.0.0-15843807-standard" -ExportToBundle -filepath ESXi-7.0.0-15843807-standard.zip\n\n    Remove-EsxSoftwareDepot https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\n')),(0,o.kt)("p",null,"\ud83d\udd35 check file name"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"after download both esxi.zip and driver.zip\nmove to windows desktop.\nopen power shell.\nuse ls to check the filename!!!\n\nmaybe  xxx.zip   in cmd is xxx.zip.zip  \nwindosn hidden extention by default.\n")),(0,o.kt)("p",null,"\ud83d\udd35 add two zip to vmware depot. \u2705"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Add-EsxSoftwareDepot C:\\... ... esxi.zip\nAdd-EsxSoftwareDepot c:\\... ... driver.zip\n")),(0,o.kt)("p",null,"\ud83d\udd36 check it "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"make sure file is imported! \n\nPS C:\\Users\\Administrator\\Desktop> Get-EsxSoftwareDepot\n\nDepot Url\n---------\nzip:C:\\Users\\Administrator\\Desktop\\esxi.zip?index.xml\nzip:C:\\Users\\Administrator\\Desktop\\usb.zip?index.xml\n")),(0,o.kt)("p",null,"\ud83d\udd35 Chack all packages. \u2705"),(0,o.kt)("p",null,"  in esxi.zip have a lot package.\nin dirver.zip only one package/dirver"),(0,o.kt)("p",null,"  after import two zip file.\nwe can see all the dirvers use this command\nmake sure our usb nic driver is listed here."),(0,o.kt)("p",null,"  Get-EsxSoftwarePackage"),(0,o.kt)("p",null,"\ud83d\udd36 get our driver's name!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"vmkusb-nic-fling         1.8-3vmw.703.0.15.51233328     VMW        11/2/2021 12:...\n")),(0,o.kt)("p",null,"\ud83d\udd35  clone a ImageProfile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"we can not change the default ImageProfile.\nhave to clone one.  and make changes on cloned ImageProfile\n")),(0,o.kt)("p",null,"\ud83d\udd36 Get default ImageProfile name"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS C:\\Users\\Administrator\\Desktop> Get-EsxImageProfile\n\nName                           Vendor          Last Modified   Acceptance Level\n----                           ------          -------------   ----------------\nESXi-7.0U3sd-19482531-standard VMware, Inc.    5/22/2022 6:... PartnerSupported\n")),(0,o.kt)("p",null,"\ud83d\udd36 clone one "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"New-EsxImageProfile -CloneProfile ESXi-7.0U3sd-19482531-standard -name esxiusb -Vendor xxxx\n\nvender name can be any you like.\n")),(0,o.kt)("p",null,"\ud83d\udd35 add driver to cloned image"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Add-EsxSoftwarePackage -ImageProfile esxiusb -SoftwarePackage vmkusb-nic-fling\n\nget the driver name you use command\nGet-EsxSoftwarePackage\n")),(0,o.kt)("p",null,"\ud83d\udd35 export image"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Export-ESXImageProfile -ImageProfile esxiusb -ExportToIso -filepath output.iso\n")))}d.isMDXComponent=!0}}]);