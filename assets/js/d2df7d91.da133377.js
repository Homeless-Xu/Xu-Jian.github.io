"use strict";(self.webpackChunkblog_never_del=self.webpackChunkblog_never_del||[]).push([[421],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=d(e.components);return o.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},c=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),c=d(t),m=i,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||r;return t?o.createElement(h,s(s({ref:n},p),{},{components:t})):o.createElement(h,s({ref:n},p))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,s=new Array(r);s[0]=c;var a={};for(var l in n)hasOwnProperty.call(n,l)&&(a[l]=n[l]);a.originalType=e,a.mdxType="string"==typeof e?e:i,s[1]=a;for(var d=2;d<r;d++)s[d]=t[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,t)}c.displayName="MDXCreateElement"},4391:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var o=t(7462),i=(t(7294),t(3905));const r={sidebar_position:1910,title:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM7"},s="NAS \u2736 ESXI \u279c Synology",a={unversionedId:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM 7",id:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM 7",title:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM7",description:"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 HomeLAB \u2736 NAS \u25aa DSM7.1 ESXI",source:"@site/docs/\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM 7.md",sourceDirName:".",slug:"/\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM 7",permalink:"/\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM 7",draft:!1,tags:[],version:"current",sidebarPosition:1910,frontMatter:{sidebar_position:1910,title:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0 NAS \u279c DSM7"},sidebar:"defaultSidebar",previous:{title:"\ud83c\udfaa-7\ufe0f\u20e3 NET \ud83c\udf10\ud83c\udf10\ud83c\udf10 VXLAN \u279c NSXT - AIO",permalink:"/\ud83c\udfaa-7\ufe0f\u20e3 NET \ud83c\udf10\ud83c\udf10\ud83c\udf10 VXLAN \u279c NSXT - AIO"},next:{title:"\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0\ud83d\udcc0 S3 \u279c MinIO",permalink:"/\ud83c\udfaa-9\ufe0f\u20e3 STO \ud83d\udcc0\ud83d\udcc0 S3 \u279c MinIO"}},l={},d=[],p={toc:d};function u(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"nas--esxi--synology"},"NAS \u2736 ESXI \u279c Synology"),(0,i.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 HomeLAB \u2736 NAS \u25aa DSM7.1 ESXI "),(0,i.kt)("p",null,"\ud83d\udd35 Why "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"truenas difficult to set file permission.\n")),(0,i.kt)("p",null,"\ud83d\udd35 How install DSM "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. download other`s custemed image.  (much easy ) \u279c  i succeed \n2. build your own image              (diffculty ) \u279c  i failed\n\nso here is demo \n    install dsm7.1 to vm under esxi7\n        i use esxi notnaml disk as data storage disk\n        if your vm use whole physical disk (maybe works too)\n\n\u203c\ufe0f if you want install dsm to physical machine this custom image no work \u203c\ufe0f\n\u203c\ufe0f if you want install dsm to physical machine this custom image no work \u203c\ufe0f\n\u203c\ufe0f if you want install dsm to physical machine this custom image no work \u203c\ufe0f\n")),(0,i.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 DSM 7.1 ESXi Demo \u2705 "),(0,i.kt)("p",null,"\ud83d\udd35 Must Know "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\u203c\ufe0f this for esxi only. no for physical machine. no waste your time. \u203c\ufe0f\n\u203c\ufe0f this for esxi only. no for physical machine. no waste your time. \u203c\ufe0f\n\n\u203c\ufe0f when begin install dsm. must cut wan internet but keep lan internet \u203c\ufe0f\n\u203c\ufe0f when begin install dsm. must cut wan internet but keep lan internet \u203c\ufe0f\n        you need lan  because you need login dsm web to install dsm system.\n        you must cut internet. during install. after install you can connect back \n")),(0,i.kt)("p",null,"\ud83d\udd35 Workflow  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"download custom img:      \u279c get two vmdk. \nupload two vmdk to esxi:  \u279c get one esxi disk (dsm boot disk)\ncreate new vm.            \u279c choose redhat ent.. 7+ \nchange bios mode to bios. (no efi)\ndelete default iscsi dirver \nadd sata dirver control  \nadd boot disk \nadd data disk\nset disk boot order (sata 0:0 / sata 0:1) \n\nboot dsm \n\nsearch ip use dysonolgy assistant tool / or check your router`s dhcp pool \nlogin dsm install web.\ndownload xxx.pat from offical web. \n    pat should same version with dsm. \n    here we download DSM_DS3617xs_42661.pat\n\n\u203c\ufe0f must no internet. if no you will enter ecovermode, if so re create vm \u203c\ufe0f\n\u203c\ufe0f must no internet. if no you will enter ecovermode, if so re create vm \u203c\ufe0f\n")),(0,i.kt)("p",null," k)"),(0,i.kt)("p",null,"\ud83d\udd36 Download customed vmkd. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. download zip \n2. get two vmkd file. \n3. upload both file to esxi \n    it auto become one esxi disk. \n")),(0,i.kt)("p",null,"\ud83d\udd35 Config VM "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\ud83d\udd36 create vm \n\n    linux / redhat ent 7+\n        we need sata control. \n        some linux version in esxi no sata control.\n\n\n\ud83d\udd36 Delete default vm config \n\n    delete default iscsi control - must\n                dsm no support iscsi dirver.\n\n    Delte cd-rom \n        we no need it .\n\n    delete default disk \n        we need delete it.  and add it back later. \n        it is about boot order.\n        this is not must. if you know how to set boot order.\n\n\n\ud83d\udd36 Add sata control  \n\n        boot disk have to use sata/ide control \n        data disk can sata mode. \n\n\n\ud83d\udd36 Add disk \n\n    we need two disk:  \n        boot disk:  the disk we download & upload to esxi. \n        Data disk:  we need install dsm system to disk! \n            data disk must 15G+ \n\n\n\n\ud83d\udd36 config disk control \n\n    boot disk must use sata/ide control. \n        you can try sata first.  if sata no bootable. use ide.\n\n    data disk.  usually sata works. \n        i just try add esxi disk create like normal vm.\n        if you rdm esxi host sata control to vm. maybe much east.\n\n    \u203c\ufe0f if you can enter dsm web. but it say no disk found. \n        either the custom image no have driver you need. or you did something wrong.\n        if you use esxi7 & add normal disk like create vm.\n        you must should be good at this step. \n\n\n\ud83d\udd36 set boot order: \n\n    Boot disk:  use sata: 0.0  means first boot disk \n    data disk:  use sata: 0.1  means second boot disk i. \n\n\n\ud83d\udd36 nic \n\n    usually   vmxnet 3 works.\n        if you boot into dsm. but no ip found.\n            try change to other. \n")),(0,i.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 DSM 7.1 DIY Image \u274c\u274c\u274c "),(0,i.kt)("p",null,"\u274c\u274c\u274c  end up no disk found.  \u274c\u274c\u274c"),(0,i.kt)("p",null,"\ud83d\udd35 Tool Desc "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"dsm default img no support esxi.\n    need add esxi nic driver.\n    if you add/mount physical disk to vm. you need add disk dirver too.\n        like nvme dirver.\n\nthis tool help you install driver to dsm image.\ncreate a custom dsm img for you.\nthen you can use thant img to create dsm vm.\n")),(0,i.kt)("p",null,"\ud83d\udd35 Tool Workflow  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"download tool from github \n\nadd some driver (esxi nic / nvme driver)\nmake a image\nmake bootfile\nboot dsm \n")),(0,i.kt)("p",null,"\ud83d\udd35 Prepair "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"we need a vm to create image.\nneed remote use screen.\n")),(0,i.kt)("p",null,"\ud83d\udd36 JQ  tool - must "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"apt install jq -y\n")),(0,i.kt)("p",null,"\ud83d\udd35 Downlaod tool "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"wget https://github.com/tossp/redpill-tool-chain/archive/refs/heads/master.zip\n\nunzip master.zip \n\nmv redpill-tool-chain-master dsm7 & cd dsm7 \n")),(0,i.kt)("p",null,"\ud83d\udd35 config default user_config \u203c\ufe0f "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\ud83d\udd36 1. rename  - must \n\n    mv sample_user_config.json ds918p_user_config.json\n    mv sample_user_config.json ds3622xsp_user_config.json\n        rename to the dsm version you want install.\n\n\ud83d\udd36 2. edit\n\n    if you use usb boot mode. you need set vid pid \n        google: vid pid usb drive\n    \n    \u203c\ufe0f if no usb node. (sata mode )   no edit. \u203c\ufe0f\n")),(0,i.kt)("p",null,"\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35\ud83d\udd35 Driver  "),(0,i.kt)("p",null,"\ud83d\udd35 Github DSM Driver Center "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"https://github.com/pocopico/rp-ext\n")),(0,i.kt)("p",null,"\ud83d\udd35 esxi nic driver - Must \u2705"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"esxi vm have three kinds nic\n    e1000\u3001e1000e\u3001vmxnet3\n        we add all. \n\n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/main/e1000/rpext-index.json\n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/main/e1000e/rpext-index.json\n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/main/vmxnet3/rpext-index.json\n")),(0,i.kt)("p",null,"\ud83d\udd35 usb nic driver - option "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/master/ax88179_178a/rpext-index.json\n")),(0,i.kt)("p",null,"\ud83d\udd35 Add other Driver "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"no too much driver. too big it will fail.\n\n\n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/master/vmw_pvscsi/rpext-index.json\n\n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/master/mvsas/rpext-index.json\n\n\n\nsata sas  \n\n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/master/aic94xx/rpext-index.json\n")),(0,i.kt)("p",null,"\ud83d\udd35 nvme   sm981/pm981/pm983"),(0,i.kt)("p",null,"\ud83d\udd35 common driver ?"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\u5b89\u88c5 thethorgroup.virtio : \n./redpill_tool_chain.sh add https://github.com/jumkey/redpill-load/raw/develop/redpill-virtio/rpext-index.json\n\n\u5b89\u88c5 thethorgroup.boot-wait : \n./redpill_tool_chain.sh add https://github.com/jumkey/redpill-load/raw/develop/redpill-boot-wait/rpext-index.json\n\n\u5b89\u88c5 pocopico.mpt3sas : \n./redpill_tool_chain.sh add https://raw.githubusercontent.com/pocopico/rp-ext/master/mpt3sas/rpext-index.json\n\n\u5b89\u88c5 jumkey.dtb : \n./redpill_tool_chain.sh add https://github.com/jumkey/redpill-load/raw/develop/redpill-dtb/rpext-index.json\n")),(0,i.kt)("p",null,"\ud83d\udd35 Build image & bootfile"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\ud83d\udd36 Check usable version \n\n    ./redpill_tool_chain.sh \n        ds3622xsp-7.1.0-42661\n        ds918p-7.1.0-42661\n\n\n\ud83d\udd36 Build image (xxx.img)\n\n    ./redpill_tool_chain.sh build ds3622xsp-7.1.0-42661\n    ./redpill_tool_chain.sh build ds918p-7.1.0-42661\n\n        here tool help us put nic driver to image.\n\n        \ud83d\udc1e if xxx libnetwork.endpointCnt: Key not found in store\n            \u203c\ufe0f sudo service docker restart & retry it \u203c\ufe0f \n            \u203c\ufe0f sudo service docker restart & retry it \u203c\ufe0f \n\n\n\ud83d\udd36 Build bootfile  (xxx.pat)\n\n    ./redpill_tool_chain.sh auto ds3622xsp-7.1.0-42661\n    ./redpill_tool_chain.sh auto ds918p-7.1.0-42661\n\n        [#] Generating GRUB config... [OK]\n        [#] Creating loader image at /opt/redpill-load/images/redpill-DS3622xs+_7.1.0-42661_b1655606748.img... [OK]\n\n\n\ud83d\udd36 Download bootable PAT image \n\n    Docker-Test.Root images pwd\n    /root/dsm7/images\n    Docker-Test.Root images ls\n    redpill-DS3622xs+_7.1.0-42661_b1655606748.img\n")),(0,i.kt)("p",null,"\ud83d\udd35 Generate SN/MAC ?"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./redpill_tool_chain.sh sn ds918p\n./redpill_tool_chain.sh sn dva3221\n")),(0,i.kt)("p",null,"\ud83d\udd35 Change IMG to VMDK(esxi)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\ud83d\udd36 Desc \n\n    this img can use on physical machine.\n    if we need use in esxi. need change img to vmdk! \n    a lot way to change img. we choose qumu-img \n\n\n\u203c\ufe0f vmdk have two kinds. workstation and esxi.\u203c\ufe0f\nwe use  StarWind V2V Image Converter  change to esxi type .\n\noutput two file.\nupload both two file to esxi. it become one xxx.vmdk!!!! \n")),(0,i.kt)("p",null,"\ud83d\udd35 esxi vm "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Create new vm. \n\nSystem: must        linux >> redhat >> ent... x 64 .. v7 \n    or  maybe no sata control\n\n\nboot mode:   bios   no efi.\n\nDelete default disk & iscsi driver.\nadd sata control. \n\nchange boot disk to sata control.\n\nadd new disk (vm virtual disk )\n    set to sata control \n\n\nboot. \n    then use dysonolgy search tool \n    or go router check what ip new vm use.\n\n\ud83d\udd36 visit dsm web    \n\n    10.1.1.50:5000 \n\n\n\ud83d\udc1e No Disk found \nmeans no driver found. \nneed add scsi driver ??\n")))}u.isMDXComponent=!0}}]);